const addTaskBtn = document.getElementById("addTaskBtn");
const taskInput = document.getElementById("taskInput");
const dateInput = document.getElementById("dateInput");
const taskList = document.getElementById("taskList");

window.onload = () => {
  loadTasks();
  updateDateTime();
  setInterval(updateDateTime, 1000);
};

addTaskBtn.addEventListener("click", addTask);

function updateDateTime() {
  const now = new Date();
  document.getElementById("currentDate").textContent = now.toDateString();
  document.getElementById("currentTime").textContent = now.toLocaleTimeString();
}

function addTask() {
  const taskText = taskInput.value.trim();
  const dueDate = dateInput.value;

  if (!taskText) return alert("Please enter a task!");
  if (!dueDate) return alert("Please select a date!");

  const taskDate = new Date(dueDate);
  const today = new Date();
  const diff = (taskDate - today) / (1000 * 3600 * 24);

  let className = "";
  if (diff < 1 && diff >= 0) className = "today";
  else if (diff < 2) className = "tomorrow";
  else className = "later";

  const li = document.createElement("li");
  li.className = className;
  li.innerHTML = `
    <div>
      <span>${taskText}</span><br>
      <span class="task-info">ðŸ“… ${dueDate}</span>
    </div>
    <div>
      <button class="complete-btn">âœ”</button>
      <button class="delete-btn">X</button>
    </div>
  `;

  li.querySelector(".delete-btn").addEventListener("click", () => {
    li.remove();
    saveTasks();
  });

  li.querySelector(".complete-btn").addEventListener("click", () => {
    li.classList.toggle("done");
    saveTasks();
  });

  taskList.appendChild(li);
  taskInput.value = "";
  dateInput.value = "";
  saveTasks();
}

function saveTasks() {
  localStorage.setItem("tasks", taskList.innerHTML);
}

function loadTasks() {
  const saved = localStorage.getItem("tasks");
  if (saved) taskList.innerHTML = saved;

  document.querySelectorAll(".delete-btn").forEach((btn) => {
    btn.addEventListener("click", (e) => {
      e.target.closest("li").remove();
      saveTasks();
    });
  });

  document.querySelectorAll(".complete-btn").forEach((btn) => {
    btn.addEventListener("click", (e) => {
      e.target.closest("li").classList.toggle("done");
      saveTasks();
    });
  });
}
